# Партицирование

Партицирование - это метод разделения больших(по количеству записей) таблиц на много маленьких

## В каких случаях партицирование не поможет либо никак не повлияет

1. время создание бэкапа
2. время восстановление из бэкапа
3. место на диске

## Ограничения и возможные проблемы по итогам партицирования

1. партицируемая таблица должна быть достаточно большого размера
2. на партицируемую таблицу нельзя ссылаться через FK (можно начиная с pg 12)
   при этом обратное(партицируемая таблица ссылаетя на другие) допустимо
3. в некоторых случая партицирование может ухудшить производительность на операциях
   чтения и записи.
4. В идеале запрос будет выполняться против одной партиции, но в худшем случае -
   затронет все партиции и, в зависимости от настроек pg, увеличит время выполнения запроса

## Виды

### Декларативное партицирование

Является встроенным и наиболее производительным решением по партиционированию, но имеет существенные ограничения.

1. Требует изначально создать таблицу, готовую к партиционированию
2. Нельзя партиционировать уже существующую таблицу через ALTER TABLE
3. При добавлении и удалении партиций будет простой в работе таблицы из за
   ACCES EXCLUSIVE LOCK(начиная с pg 12 режим блокировки более щадящий: можно использовать
   SELECT, но только без FOR UPDATE/SHARE)

### Партицирование через наследование

Является более гибким решением

1. можно партицировать уже существующую таблицу
2. нет даунтайма при добавлении и удалении партиций
3. можно задать любой произвольный критерий партицирования
4. возможно множественное наследование
5. можно безболезненно отменить

```
CREATE TABLE table_name (
    id SERIAL PK
) inherits (table_name)
```
