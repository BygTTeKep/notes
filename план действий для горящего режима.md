## Приоритезация: Триада "Стоп-Кровь-Хирургия"

| Категория | Действие                                  | Пример                                  |
| --------- | ----------------------------------------- | --------------------------------------- |
| Стоп      | Критические баги (падения, потери данных) | Сервер не отвечает, платежи не проходят |
| Кровь     | Важные, но не блокирующие                 | UI глючит, но функционал работает       |
| Хирургия  | Рефакторинг/долг                          | Улучшение архитектуры, чистка кода      |

ПравилоТратьте 70% времени на "Стоп", 20% на "Кровь", 10% на "Хирургию".

## Тактика "Пожарного рефакторинга"

Локализация утечек
Вместо глобального рефакторинга — точечные исправления в самых проблемных местах:

```
// Было:
function processData(data) {
  // 200 строк спагетти-кода
}

// Стало:
function processData(data) {
  try {
    validateData(data); // Вынесли валидацию
    const parsed = parseData(data); // Разделили логику
    return saveData(parsed); // Изолировали запись
  } catch (e) {
    logError(e); // Централизованная обработка
  }
}
```

Эффект: Снижение риска при исправлении багов.

## Подход "Шрамов"

Помечайте проблемные места комментариями // FIXME: с кратким описанием:

```

// FIXME: Уязвимость SQL-инъекции, переписать на параметризованные запросы
db.query(`SELECT * FROM users WHERE id = ${id}`);

```

Инструменты:

**Поиск по коду:** `grep -r "FIXME:" ./src`

**Автоматизация:** Добавьте линтер-правило для подсветки FIXME.

## Инструменты экстренного контроля

### Feature Flags

Оберните проблемный функционал в переключатель:

```

if (featureFlags.useNewPaymentProcessor) {
    processPaymentNew(); // Рефакторнутая версия
} else {
    processPaymentLegacy(); // Старая костыльная версия
}

```

**Плюсы**: Можно быстро отключить бажный код без деплоя.

### Circuit Breaker

Добавьте "предохранитель" для нестабильных модулей:

```
let errorsCount = 0;
function unstableServiceCall() {
  if (errorsCount > 5) throw new Error("Circuit tripped!");
  try {
    // Вызов проблемного сервиса
  } catch (e) {
    errorsCount++;
    throw e;
  }
}

```

## Командные практики

### Война с багами: "День Д"

Соберите войсковую оперативку утром: 15 минут на оценку критичности.

Разделите команду:

-   Штурмовики: Тушат баги.

-   Сапёры: Пишут тесты для проблемных зон.

-   Разведка: Анализирует корневые причины.

### Техника "5 Почему"

Для каждого бага задавайте вопрос "Почему?" до корневой причины:

Почему упал сервер? — Переполнение памяти.

Почему переполнение? — Утечка в кеше.

Почему утечка? — Нет очистки по TTL.
→ Фикс: Добавить cache.set(key, value, { ttl: 60 }).

## Стратегия долгосрочного выживания

Микродозы рефакторинга
**Правило бойскаута: "Оставляй код чище, чем нашёл".**
**Пример**: Исправляя баг в функции, отрефакторьте её, но не трогайте соседний код.

## Долговая книга

Ведите Tech Debt Registry (Google-таблица или Issues в Git):

| Модуль     | Проблема              | Приоритет | Стоимость |
| ---------- | --------------------- | --------- | --------- |
| payment.js | Race-условия          | High      | 8h        |
| auth.ts    | Устаревшая библиотека | Medium    | 16h       |

## Переговорные тактики с менеджментом

**Фрейминг через риски**:
"Если не починить модуль X, следующие баги будут стоить $N в месяц".

**Метрики**: Замеряйте время на фикс багов до/после рефакторинга.

Чеклист на первые 72 часа

1. Остановить кровотечение (критические баги).

2. Включить feature flags для нестабильного кода.

3. Завести Tech Debt Registry.

4. Назначить "разведчика" для анализа корневых причин.

**Запланировать 1 час в день на "точечный рефакторинг".**

Главное: Не пытайтесь переписать всё сразу. Системно повышайте живучесть системы, даже минимальными изменениями.
